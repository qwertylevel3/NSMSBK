<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Search Rule</title>

    {% include "__staticFiles.html" %}

    <script>

        function deleteFun(id) {
            $.post(
                "{% url 'ruleDelete' %}",
                {"id": id},
                function (ret) {
                    if (ret.result) {
                        alert("操作成功")
                        window.location.replace("{% url 'ruleSearch' %}");
                    } else {
                        alert("操作失败")
                    }
                }
            )
        }
        function reuseFun(id) {
            $.post(
                "{% url 'ruleReuse' %}",
                {"id": id},
                function (ret) {
                    if (ret.result) {
                        alert("操作成功")
                        window.location.replace("{% url 'ruleSearch' %}");
                    } else {
                        alert("操作失败")
                    }
                }
            )
        }

    </script>

</head>
<body>

{% include "__head.html" %}

<div class="container-fluid main-div">

    <div class="row">
        <div class="col-md-12">
            <h2>搜索规则</h2>
        </div>
    </div>

    <div class="row">
        <div class="col-md-12">
            <form id="ruleSearchForm" action="{% url 'ruleSearch' %}" method="post">
                {% include "ruleConfig/__conditionTable.html" %}
                <label><input type="radio" name="showState" id="showAll" value="0" checked>搜索全部</label>
                <label><input type="radio" name="showState" id="showIsUsed" value="1"/>仅搜索已启用</label>
                <label><input type="radio" name="showState" id="showNotUsed" value="2"/>仅搜索未启用</label>
            </form>
        </div>
    </div>

    <div class="row">
        <div class="col-md-6">
        </div>
        <div class="col-md-3">
            <form action="{% url 'ruleRevise' %}" method="get">
                <input type="text" name="id" value="-1" hidden>
                <input type="submit" class="button" value="新增"/>
            </form>
        </div>
        <div class="col-md-3">
            <button class="button" type="submit" form="ruleSearchForm" value="Submit">搜索</button>
        </div>

    </div>
    <div class="row">
        <div class="col-md-12">
            <h2>搜索结果(共{{ resultSize }}条)</h2>
        </div>
    </div>
    <div class="row">
        <div class="col-md-12">

            <table class="result-table table-hover table-condensed" border="1">
                <thead>
                <th>id</th>
                <th>国家</th>
                <th>省份</th>
                <th>城市</th>
                <th>host</th>
                <th>appid</th>
                <th>net</th>
                <th>服务器组</th>
                <th>rank</th>
                <th>ttl</th>
                <th>compel</th>
                <th>启用</th>
                </thead>
                <tbody>
                {% for line in result %}
                    <tr>
                        <td>{{ line.id }}</td>
                        <td>{{ line.country }}</td>
                        <td>{{ line.province }}</td>
                        <td>{{ line.city }}</td>
                        <td>{{ line.host }}</td>
                        <td>{{ line.appid }}</td>
                        <td>{{ line.net }}</td>
                        <td>{{ line.group_id }}</td>
                        <td>{{ line.rank }}</td>
                        <td>{{ line.ttl }}</td>
                        <td>{{ line.compel }}</td>
                        <td>{{ line.is_use }}</td>
                        <td>
                            <form action="{% url 'ruleRevise' %}" method="">
                                <input type="text" name="id" value="{{ line.id }}" hidden/>
                                <input type="submit" class="table-button" value="更改"/>
                            </form>
                        </td>
                        <td>
                            <button id="deleteButton{{ line.id }}" class="table-button"
                                    onclick="deleteFun({{ line.id }})">禁用
                            </button>
                        </td>
                        <td>
                            <button id="reuseButton{{ line.id }}" class="table-button"
                                    onclick="reuseFun({{ line.id }})">启用
                            </button>
                        </td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    <div class="row">
        <div class="col-md-12">
            <div class="pagination">
                <span class="step-links">
                {% if result.has_previous %}
                    <a class="button" href="?page={{ result.previous_page_number }}">上一页</a>
                {% endif %}

                    <span class="current">
                    Page {{ result.number }} of {{ result.paginator.num_pages }}.
                </span>

                    {% if result.has_next %}
                        <a class="button" href="?page={{ result.next_page_number }}">下一页</a>
                    {% endif %}
                </span>
            </div>
        </div>
    </div>
</div>
</body>
</html>